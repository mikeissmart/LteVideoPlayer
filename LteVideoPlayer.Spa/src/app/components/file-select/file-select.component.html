<div class="row pb-3 text-center">
  <div class="col-3 col-lg-2">
    <div class="form-check" *ngIf="isAdmin">
      <input type="checkbox" class="form-check-input" id="isStaging" (change)="stagingChanged()"
        [checked]="isStaging" />
      <label class="form-check-label" for="isStaging">Use Staging</label>
    </div>
  </div>
  <div class="col-3 col-lg-2" *ngIf="isAdmin">
    <button class="btn btn-sm btn-primary form-control" (click)="getAndDisplayThumbnailInfo()">
      Get Thumbnail Info
    </button>
  </div>
  <div class="col-3 col-lg-2" *ngIf="isAdmin">
    <button class="btn btn-sm btn-primary form-control" (click)="convertFilesListAll()">
      List All Converts
    </button>
  </div>
  <div class="col-4 col-lg-3" *ngIf="isStaging">
    <button class="btn btn-sm btn-success form-control" (click)="convertAllFiles()">
      Queue Convert Directory
    </button>
  </div>
</div>
<div class="row pb-3">
  <div class="col-12">
    <p>Path: \{{ currentDirPathName }}</p>
    <app-input-validation property="Directory" [validations]="errors"></app-input-validation>
  </div>
</div>
<div class="row pb-1">
  <div class="col-2 col-lg-1">
    <button class="btn btn-sm btn-primary form-control" (click)="popDir()" [disabled]="currentDirPathName == ''">
      Back
    </button>
  </div>
  <div class="col-10 col-lg-11">..</div>
</div>
<!--<div class="row pb-1" *ngFor="let item of dirsAndFiles.dirs">
  <div class="col-2 col-lg-1">
    <button class="btn btn-sm btn-primary form-control" (click)="pushDir(item)">
      Open
    </button>
  </div>
  <div class="col-10 col-lg-11">
    {{ item.dirName }}
  </div>
</div>
<div class="row pb-1" *ngFor="let item of dirsAndFiles.files">
  <div class="col-2 col-lg-1">
    <button
      class="btn btn-sm btn-success form-control"
      *ngIf="!isStaging"
      (click)="playFile(item)"
    >
      Play
    </button>
    <button
      class="btn btn-sm btn-success form-control"
      *ngIf="isStaging && item.convertQueued == false"
      (click)="convertFile(item)"
    >
      Convert
    </button>
    <span class="text-danger" *ngIf="isStaging && item.convertQueued == true">
      Converting
    </span>
  </div>
  <div class="col-10 col-lg-11">
    {{ item.fileName }}
  </div>
</div>-->
<div class="row pb-1">
  <div class="col-3 p-3" *ngFor="let item of dirsAndFiles.dirs">
    <div *ngIf="!isStaging" class="img-container pb-3">
      <img class="" [src]="thumbnailService.getFolderThumbnailUrl(item.dirPathName!)" />
    </div>
    <div class="row justify-content-center">
      <button class="btn btn-sm btn-primary form-control" (click)="pushDir(item)">
        {{ item.dirName }}
      </button>
    </div>
  </div>
</div>
<hr *ngIf="dirsAndFiles.dirs!.length > 0 && dirsAndFiles.files!.length > 0" />
<div class="row pb-1">
  <div class="col-3 p-3" *ngFor="let item of dirsAndFiles.files">
    <div *ngIf="!isStaging" class="img-container pb-3">
      <img class="" [src]="thumbnailService.getFileThumbnailUrl(item.filePathName!)" />
    </div>
    <div class="row justify-content-center">
      <button *ngIf="!isStaging" class="btn btn-sm btn-primary form-control" (click)="playFile(item)">
        {{ item.fileName }}
      </button>
      <button *ngIf="isStaging" class="btn btn-sm form-control"
        [ngClass]="item.convertQueued ? 'btn-danger' : 'btn-primary'" [disabled]="item.convertQueued"
        (click)="convertFile(item)">
        {{ item.convertQueued ? "Converting" : "Convert" }} -
        {{ item.fileName }}
      </button>
    </div>
  </div>

  <!--<div class="col-2 col-lg-1">
    <button
      class="btn btn-sm btn-success form-control"
      *ngIf="!isStaging"
      (click)="playFile(item)"
    >
      Play
    </button>
    <button
      class="btn btn-sm btn-success form-control"
      *ngIf="isStaging && item.convertQueued == false"
      (click)="convertFile(item)"
    >
      Convert
    </button>
    <span class="text-danger" *ngIf="isStaging && item.convertQueued == true">
      Converting
    </span>
  </div>
  <div class="col-10 col-lg-11">
    {{ item.fileName }}
  </div>
</div>-->

  <app-modal #convertAllModal [showCloseBtn]="false" size="xl">
    <div header>
      <h4>Queue Convert Directory</h4>
    </div>
    <div body>
      <app-convert-file-add-many #convertAll (onCovertFileQueued)="setConvertQueued($event)"
        (onCovertFilesAllSaved)="convertAllModal.closeModal()" (onCancel)="convertAllModal.closeModal()"
        (onVideoMeta)="onVideoMeta($event)"></app-convert-file-add-many>
    </div>
  </app-modal>
  <app-modal #convertModal [showCloseBtn]="false" size="xl">
    <div header>
      <h4>Queue Convert File</h4>
    </div>
    <div body>
      <p>
        <app-convert-file-add #convert (onCovertFileSaved)="convertModal.closeModal()"
          (onCancel)="convertModal.closeModal()" (onVideoMeta)="onVideoMeta($event)"></app-convert-file-add>
      </p>
    </div>
  </app-modal>
  <app-modal #convertListAllModal [showCloseBtn]="true" size="xl" fullscreen="lg">
    <div header>
      <h4>All Convert Files</h4>
    </div>
    <div body>
      <app-convert-file-list-all #convertListAll></app-convert-file-list-all>
    </div>
  </app-modal>
  <app-modal #workingThumbnailModal [showCloseBtn]="true" size="xl" fullscreen="lg">
    <div header>
      <h4>Thumbnail Info</h4>
    </div>
    <div body>
      <div class="row">
        <div class="col">Working Thumbnail</div>
        <div class="col">
          <button class="btn btn-primary" (click)="getWorkingThumbnail()">Refresh</button>
        </div>
      </div>
      <p class="col">{{ workingThumbnail }}</p>
      <hr>
      <div class="d-flex justify-content-end">
        <div class="btn btn-danger" (click)="deleteManyThumbnailErrors()">Delete All</div>
      </div>
      <div class="row">
        <div class="table-responsive">
          <table class="table text-light">
            <thead>
              <tr>
                <th>Time Errored</th>
                <th>Last Error</th>
                <th>File</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of thumbnailErrors">
                <td>{{ item.timesFailed }}</td>
                <td>{{ item.lastError | date : "short" }}</td>
                <td style="cursor: pointer;" (click)="displayThumbnailError(item)">{{ item.file!.filePathName
                  }}</td>
                <td>
                  <button class="btn btn-sm btn-danger" (click)="deleteThumbnailError(item)">Delete</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </app-modal>
  <app-video-player #videoPlayer (onFilePlayChange)="onPlayFileChange($event)" (onPlayerClose)="onPlayerClose()"
    (onVideoMeta)="onVideoMeta($event)"></app-video-player>
  <app-modal #videoMeta [showCloseBtn]="true" size="xl">
    <div header>
      <h4>Video Meta</h4>
    </div>
    <div body>
      <p>Output</p>
      <p>{{ metaData?.output }}</p>
      <hr />
      <p>Error</p>
      <p>{{ metaData?.error }}</p>
    </div>
  </app-modal>
  <app-modal #disThumbErrorModal [showCloseBtn]="true" size="xl">
    <div header>
      <h4>{{ disThumbError?.file?.filePathName }}</h4>
    </div>
    <div body>
      <p>Error</p>
      <p>{{ disThumbError?.error }}</p>
      <hr />
    </div>
  </app-modal>
</div>